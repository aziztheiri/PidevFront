<h3>Liste des Sinistres</h3>
<div class="mb-3">
  <button routerLink="/user/sinistre-form" class="btn btn-primary btn-lg">+ Ajouter</button>
  <button (click)="generatePDF()" class="btn btn-success btn-lg">Télécharger PDF</button>
</div>

<div class="row mb-3">
  <div class="col-md-6">
    <input type="text" [(ngModel)]="searchText" placeholder="Rechercher..." class="form-control form-control-lg" />
  </div>
  <div class="col-md-6">
    <select [(ngModel)]="selectedStatut" class="form-control form-control-lg">
      <option value="">Tous</option>
      <option *ngFor="let st of statutsDisponibles" [value]="st">{{ st }}</option>
    </select>
  </div>
</div>

<table class="table table-hover mt-3" *ngIf="filteredSinistres.length">
  <thead>
    <tr>
      <th>ID</th>
      <th>Date</th>
      <th>Description</th>
      <th>Statut</th>
      <th>Montant</th>
      <th>Lieu</th>
      <th>Type</th>
      <th>Responsabilité</th>
      <th>Téléphone</th>
      <th>Météo</th>
      <th>Route</th>
      <th>Lumière</th>
      <th>Zone</th>
      <th>Clôture</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let s of filteredSinistres">
      <td>{{ s.id }}</td>
      <td>{{ s.dateDeclaration | date: 'dd/MM/yyyy' }}</td>
      <td>{{ s.description }}</td>
      <td>{{ s.statut }}</td>
      <td>{{ s.montantEstime | currency }}</td>
      <td>{{ s.lieu }}</td>
      <td>{{ s.typeSinistre }}</td>
      <td>{{ s.responsabilite }}</td>
      <td>{{ s.telephone }}</td>
      <td>{{ s.weatherCondition }}</td>
      <td>{{ s.roadSurfaceCondition }}</td>
      <td>{{ s.lightCondition }}</td>
      <td>{{ s.urbanOrRuralArea === 1 ? 'Urbain' : 'Rural' }}</td>
      <td>{{ s.dateCloture ? (s.dateCloture | date: 'dd/MM/yyyy') : 'Non' }}</td>
      <td>
        <button (click)="predictSeverity(s)" class="btn btn-primary btn-sm mb-1">⚡ Prédire</button>
        <div *ngIf="predictions[s.id] !== undefined">
          <small>{{ predictions[s.id] }} – {{ getLabel(predictions[s.id]) }}</small>
        </div>
        <button [routerLink]="['/user/sinistre-detail', s.id]" class="btn btn-info btn-sm">Voir</button>
        <button [routerLink]="['/user/sinistre-form', s.id]" class="btn btn-warning btn-sm">Modif</button>
        <button (click)="deleteSinistre(s.id)" class="btn btn-danger btn-sm">Suppr</button>
      </td>
    </tr>
  </tbody>
</table>

<p *ngIf="!filteredSinistres.length" class="text-muted">Aucun sinistre trouvé.</p>
